!function(t,e){if("object"==typeof exports&&exports)e(exports)
else{var n={}
e(n),"function"==typeof define&&define.amd?define(n):t.Mustache=n}}(this,function(t){function e(t,e){return w.call(t,e)}function n(t){return!e(y,t)}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function r(t){return(t+"").replace(/[&<>"'\/]/g,function(t){return _[t]})}function o(t){this.string=t,this.tail=t,this.pos=0}function a(t,e){this.view=t||{},this.parent=e,this._cache={}}function s(){this.clearCache()}function c(e,n,i,r){var o,a,s,l,p,u,h,f,g=""
for(l=0,p=e.length;p>l;++l)switch(o=e[l],a=o[1],o[0]){case"#":if(s=i.lookup(a),"object"==typeof s)if(x(s))for(u=0,h=s.length;h>u;++u)g+=c(o[4],n,i.push(s[u]),r)
else s&&(g+=c(o[4],n,i.push(s),r))
else"function"==typeof s?(f=null==r?null:r.slice(o[3],o[5]),s=s.call(i.view,f,function(t){return n.render(t,i)}),null!=s&&(g+=s)):s&&(g+=c(o[4],n,i,r))
break
case"^":s=i.lookup(a),(!s||x(s)&&0===s.length)&&(g+=c(o[4],n,i,r))
break
case">":s=n.getPartial(a),"function"==typeof s&&(g+=s(i))
break
case"&":s=i.lookup(a),null!=s&&(g+=s)
break
case"name":s=i.lookup(a),null!=s&&(g+=t.escape(s))
break
case"text":g+=a}return g}function l(t){var e,n,i,r,o=[],a=o,s=[]
for(n=0,i=t.length;i>n;++n)switch(e=t[n],e[0]){case"#":case"^":s.push(e),a.push(e),a=e[4]=[]
break
case"/":r=s.pop(),r[5]=e[2],a=s.length>0?s[s.length-1][4]:o
break
default:a.push(e)}return o}function p(t){var e,n,i,r,o=[]
for(i=0,r=t.length;r>i;++i)e=t[i],e&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(n=e,o.push(e)))
return o}function u(t){return[RegExp(i(t[0])+"\\s*"),RegExp("\\s*"+i(t[1]))]}function h(e,r){function a(){if(w&&!b)for(;y.length;)delete f[y.pop()]
else y=[]
w=!1,b=!1}var s,c,h,f,y,w,b,x,_,U,E,P,C,j,A
if(e=e||"",r=r||t.tags,"string"==typeof r&&(r=r.split(m)),2!==r.length)throw Error("Invalid tags: "+r.join(", "))
for(s=u(r),c=new o(e),h=[],f=[],y=[],w=!1,b=!1;!c.eos();){if(x=c.pos,U=c.scanUntil(s[0]))for(C=0,j=U.length;j>C;++C)E=U.charAt(C),n(E)?y.push(f.length):b=!0,f.push(["text",E,x,x+1]),x+=1,"\n"==E&&a()
if(!c.scan(s[0]))break
if(w=!0,_=c.scan(k)||"name",c.scan(g),"="===_?(U=c.scanUntil(d),c.scan(d),c.scanUntil(s[1])):"{"===_?(U=c.scanUntil(RegExp("\\s*"+i("}"+r[1]))),c.scan(v),c.scanUntil(s[1]),_="&"):U=c.scanUntil(s[1]),!c.scan(s[1]))throw Error("Unclosed tag at "+c.pos)
if(P=[_,U,x,c.pos],f.push(P),"#"===_||"^"===_)h.push(P)
else if("/"===_){if(0===h.length)throw Error('Unopened section "'+U+'" at '+x)
if(A=h.pop(),A[1]!==U)throw Error('Unclosed section "'+A[1]+'" at '+x)}else if("name"===_||"{"===_||"&"===_)b=!0
else if("="===_){if(r=U.split(m),2!==r.length)throw Error("Invalid tags at "+x+": "+r.join(", "))
s=u(r)}}if(A=h.pop())throw Error('Unclosed section "'+A[1]+'" at '+c.pos)
return f=p(f),l(f)}var f,g=/\s*/,m=/\s+/,y=/\S/,d=/\s*=/,v=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/,w=RegExp.prototype.test,b=Object.prototype.toString,x=Array.isArray||function(t){return"[object Array]"===b.call(t)},_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}
o.prototype.eos=function(){return""===this.tail},o.prototype.scan=function(t){var e=this.tail.match(t)
return e&&0===e.index?(this.tail=this.tail.substring(e[0].length),this.pos+=e[0].length,e[0]):""},o.prototype.scanUntil=function(t){var e,n=this.tail.search(t)
switch(n){case-1:e=this.tail,this.pos+=this.tail.length,this.tail=""
break
case 0:e=""
break
default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return e},a.make=function(t){return t instanceof a?t:new a(t)},a.prototype.push=function(t){return new a(t,this)},a.prototype.lookup=function(t){var e,n,i,r=this._cache[t]
if(!r){if("."==t)r=this.view
else for(e=this;e;){if(t.indexOf(".")>0)for(r=e.view,n=t.split("."),i=0;r&&i<n.length;)r=r[n[i++]]
else r=e.view[t]
if(null!=r)break
e=e.parent}this._cache[t]=r}return"function"==typeof r&&(r=r.call(this.view)),r},s.prototype.clearCache=function(){this._cache={},this._partialCache={}},s.prototype.compile=function(e,n){var i,r=this._cache[e]
return r||(i=t.parse(e,n),r=this._cache[e]=this.compileTokens(i,e)),r},s.prototype.compilePartial=function(t,e,n){var i=this.compile(e,n)
return this._partialCache[t]=i,i},s.prototype.getPartial=function(t){return t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t)),this._partialCache[t]},s.prototype.compileTokens=function(t,e){var n=this
return function(i,r){if(r)if("function"==typeof r)n._loadPartial=r
else for(var o in r)n.compilePartial(o,r[o])
return c(t,n,a.make(i),e)}},s.prototype.render=function(t,e,n){return this.compile(t)(e,n)},t.name="mustache.js",t.version="0.7.2",t.tags=["{{","}}"],t.Scanner=o,t.Context=a,t.Writer=s,t.parse=h,t.escape=r,f=new s,t.clearCache=function(){return f.clearCache()},t.compile=function(t,e){return f.compile(t,e)},t.compilePartial=function(t,e,n){return f.compilePartial(t,e,n)},t.compileTokens=function(t,e){return f.compileTokens(t,e)},t.render=function(t,e,n){return f.render(t,e,n)},t.to_html=function(e,n,i,r){var o=t.render(e,n,i)
return"function"!=typeof r?o:(r(o),void 0)}})
